version: "3.8"
services:
  ultrathink:
    build: .
    container_name: ultrathink
    restart: unless-stopped
    user: "1000:1000"
    environment:
      - TELEGRAM_BOT_TOKEN=${TELEGRAM_BOT_TOKEN}
      - TELEGRAM_CHAT_ID=${TELEGRAM_CHAT_ID}
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - TZ=${TIMEZONE:-Australia/Brisbane}
      - CONFIDENCE_THRESHOLD=${CONFIDENCE_THRESHOLD:-0.6}
    volumes:
      - ./vault:/vault

  filebrowser:
    image: filebrowser/filebrowser
    container_name: filebrowser
    restart: unless-stopped
    volumes:
      - ./vault:/srv
      - ./filebrowser.db:/database.db
    ports:
      - "8080:80"
    environment:
      - TZ=${TIMEZONE:-Australia/Brisbane}

  syncthing:
    image: syncthing/syncthing
    container_name: syncthing
    restart: unless-stopped
    hostname: ultrathink-server
    volumes:
      - ./vault:/var/syncthing/vault
      - ./syncthing-config:/var/syncthing/config
    ports:
      - "8384:8384"   # Web UI
      - "22000:22000/tcp"  # Sync protocol
      - "22000:22000/udp"
      - "21027:21027/udp"  # Discovery
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=${TIMEZONE:-Australia/Brisbane}
